 <nav class="navbar navbar-light navbar-glass navbar-top navbar-expand">

            <button class="btn navbar-toggler-humburger-icon navbar-toggler me-1 me-sm-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarVerticalCollapse" aria-controls="navbarVerticalCollapse" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>
            <a class="navbar-brand me-1 me-sm-3" href="/backend_Stock/index.php">
              <div class="d-flex align-items-center"><img class="me-2" src="/backend_Stock/assets/img/icons/spot-illustrations/falcon.png" alt="" width="40" /><span class="font-sans-serif">falcon</span>
              </div>
            </a>
            <ul class="navbar-nav align-items-center d-none d-lg-block">
              <li class="nav-item">
                <div class="search-box" data-list='{"valueNames":["title"]}'>
                  <form class="position-relative" data-bs-toggle="search" data-bs-display="static">
                    <input class="form-control search-input fuzzy-search" type="search" placeholder="Search..." aria-label="Search" />
                    <span class="fas fa-search search-box-icon"></span>

                  </form>
                  <div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none" data-bs-dismiss="search">
                    <button class="btn btn-link btn-close-falcon p-0" aria-label="Close"></button>
                  </div>
                  <div class="dropdown-menu border font-base start-0 mt-2 py-0 overflow-hidden w-100">
                    <div class="scrollbar list py-3" style="max-height: 24rem;">
                      <h6 class="dropdown-header fw-medium text-uppercase px-x1 fs--2 pt-0 pb-2">Recently Browsed</h6><a class="dropdown-item fs--1 px-x1 py-1 hover-primary" href="/backend_Stock/app/events/event-detail.php">
                        <div class="d-flex align-items-center">
                          <span class="fas fa-circle me-2 text-300 fs--2"></span>

                          <div class="fw-normal title">Pages <span class="fas fa-chevron-right mx-1 text-500 fs--2" data-fa-transform="shrink-2"></span> Events</div>
                        </div>
                      </a>
                      <a class="dropdown-item fs--1 px-x1 py-1 hover-primary" href="/backend_Stock/app/e-commerce/customers.php">
                        <div class="d-flex align-items-center">
                          <span class="fas fa-circle me-2 text-300 fs--2"></span>

                          <div class="fw-normal title">E-commerce <span class="fas fa-chevron-right mx-1 text-500 fs--2" data-fa-transform="shrink-2"></span> Customers</div>
                        </div>
                      </a>

                      <hr class="text-200 dark__text-900" />
                      <h6 class="dropdown-header fw-medium text-uppercase px-x1 fs--2 pt-0 pb-2">Suggested Filter</h6><a class="dropdown-item px-x1 py-1 fs-0" href="/backend_Stock/app/e-commerce/customers.php">
                        <div class="d-flex align-items-center"><span class="badge fw-medium text-decoration-none me-2 badge-soft-warning">customers:</span>
                          <div class="flex-1 fs--1 title">All customers list</div>
                        </div>
                      </a>
                      <a class="dropdown-item px-x1 py-1 fs-0" href="/backend_Stock/app/events/event-detail.php">
                        <div class="d-flex align-items-center"><span class="badge fw-medium text-decoration-none me-2 badge-soft-success">events:</span>
                          <div class="flex-1 fs--1 title">Latest events in current month</div>
                        </div>
                      </a>
                      <a class="dropdown-item px-x1 py-1 fs-0" href="/backend_Stock/app/e-commerce/product/product-grid.php">
                        <div class="d-flex align-items-center"><span class="badge fw-medium text-decoration-none me-2 badge-soft-info">products:</span>
                          <div class="flex-1 fs--1 title">Most popular products</div>
                        </div>
                      </a>

                      <hr class="text-200 dark__text-900" />
                      <h6 class="dropdown-header fw-medium text-uppercase px-x1 fs--2 pt-0 pb-2">Files</h6><a class="dropdown-item px-x1 py-2" href="#!">
                        <div class="d-flex align-items-center">
                          <div class="file-thumbnail me-2"><img class="border h-100 w-100 fit-cover rounded-3" src="/backend_Stock/assets/img/products/3-thumb.png" alt="" /></div>
                          <div class="flex-1">
                            <h6 class="mb-0 title">iPhone</h6>
                            <p class="fs--2 mb-0 d-flex"><span class="fw-semi-bold">Antony</span><span class="fw-medium text-600 ms-2">27 Sep at 10:30 AM</span></p>
                          </div>
                        </div>
                      </a>
                      <a class="dropdown-item px-x1 py-2" href="#!">
                        <div class="d-flex align-items-center">
                          <div class="file-thumbnail me-2"><img class="img-fluid" src="/backend_Stock/assets/img/icons/zip.png" alt="" /></div>
                          <div class="flex-1">
                            <h6 class="mb-0 title">Falcon v1.8.2</h6>
                            <p class="fs--2 mb-0 d-flex"><span class="fw-semi-bold">John</span><span class="fw-medium text-600 ms-2">30 Sep at 12:30 PM</span></p>
                          </div>
                        </div>
                      </a>

                      <hr class="text-200 dark__text-900" />
                      <h6 class="dropdown-header fw-medium text-uppercase px-x1 fs--2 pt-0 pb-2">Members</h6><a class="dropdown-item px-x1 py-2" href="/backend_Stock/pages/user/profile.php">
                        <div class="d-flex align-items-center">
                          <div class="avatar avatar-l status-online me-2">
                            <img class="rounded-circle" src="/backend_Stock/assets/img/team/1.jpg" alt="" />

                          </div>
                          <div class="flex-1">
                            <h6 class="mb-0 title">Anna Karinina</h6>
                            <p class="fs--2 mb-0 d-flex">Technext Limited</p>
                          </div>
                        </div>
                      </a>
                      <a class="dropdown-item px-x1 py-2" href="/backend_Stock/pages/user/profile.php">
                        <div class="d-flex align-items-center">
                          <div class="avatar avatar-l me-2">
                            <img class="rounded-circle" src="/backend_Stock/assets/img/team/2.jpg" alt="" />

                          </div>
                          <div class="flex-1">
                            <h6 class="mb-0 title">Antony Hopkins</h6>
                            <p class="fs--2 mb-0 d-flex">Brain Trust</p>
                          </div>
                        </div>
                      </a>
                      <a class="dropdown-item px-x1 py-2" href="/backend_Stock/pages/user/profile.php">
                        <div class="d-flex align-items-center">
                          <div class="avatar avatar-l me-2">
                            <img class="rounded-circle" src="/backend_Stock/assets/img/team/3.jpg" alt="" />

                          </div>
                          <div class="flex-1">
                            <h6 class="mb-0 title">Emma Watson</h6>
                            <p class="fs--2 mb-0 d-flex">Google</p>
                          </div>
                        </div>
                      </a>

                    </div>
                    <div class="text-center mt-n3">
                      <p class="fallback fw-bold fs-1 d-none">No Result Found.</p>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-icons ms-auto flex-row align-items-center">
              <li class="nav-item">
                <div class="theme-control-toggle fa-icon-wait px-2">
                  <input class="form-check-input ms-0 theme-control-toggle-input" id="themeControlToggle" type="checkbox" data-theme-control="theme" value="dark" />
                  <label class="mb-0 theme-control-toggle-label theme-control-toggle-light" for="themeControlToggle" data-bs-toggle="tooltip" data-bs-placement="left" title="Switch to light theme"><span class="fas fa-sun fs-0"></span></label>
                  <label class="mb-0 theme-control-toggle-label theme-control-toggle-dark" for="themeControlToggle" data-bs-toggle="tooltip" data-bs-placement="left" title="Switch to dark theme"><span class="fas fa-moon fs-0"></span></label>
                </div>
              </li>
             
              <!-- notifation -->
              <li class="nav-item dropdown">
                <a class="nav-link notification-indicator notification-indicator-primary px-0 fa-icon-wait" id="navbarDropdownNotification" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-hide-on-body-scroll="data-hide-on-body-scroll"><span class="fas fa-bell" data-fa-transform="shrink-6" style="font-size: 33px;"></span></a>
                <div class="dropdown-menu dropdown-caret dropdown-caret dropdown-menu-end dropdown-menu-card dropdown-menu-notification dropdown-caret-bg" aria-labelledby="navbarDropdownNotification">
                  <div class="card card-notification shadow-none">
                    <div class="card-header">
                      <div class="row justify-content-between align-items-center">
                        <div class="col-auto">
                          <h6 class="card-header-title mb-0">Notifications</h6>
                        </div>
                        <div class="col-auto ps-0 ps-sm-3"><a class="card-link fw-normal" href="#">Mark all as read</a></div>
                      </div>
                    </div>
                    <div class="scrollbar-overlay" style="max-height:19rem">
                      <div class="list-group list-group-flush fw-normal fs--1">
                        <div class="list-group-title border-bottom">NEW</div>
                        <div class="list-group-item">
                          <a class="notification notification-flush notification-unread" href="#!">
                            <div class="notification-avatar">
                              <div class="avatar avatar-2xl me-3">
                                <img class="rounded-circle" src="/backend_Stock/assets/img/team/1-thumb.png" alt="" />

                              </div>
                            </div>
                            <div class="notification-body">
                              <p class="mb-1"><strong>Emma Watson</strong> replied to your comment : "Hello world üòç"</p>
                              <span class="notification-time"><span class="me-2" role="img" aria-label="Emoji">üí¨</span>Just now</span>

                            </div>
                          </a>

                        </div>
                        <div class="list-group-item">
                          <a class="notification notification-flush notification-unread" href="#!">
                            <div class="notification-avatar">
                              <div class="avatar avatar-2xl me-3">
                                <div class="avatar-name rounded-circle"><span>AB</span></div>
                              </div>
                            </div>
                            <div class="notification-body">
                              <p class="mb-1"><strong>Albert Brooks</strong> reacted to <strong>Mia Khalifa's</strong> status</p>
                              <span class="notification-time"><span class="me-2 fab fa-gratipay text-danger"></span>9hr</span>

                            </div>
                          </a>

                        </div>
                        <div class="list-group-title border-bottom">EARLIER</div>
                        <div class="list-group-item">
                          <a class="notification notification-flush" href="#!">
                            <div class="notification-avatar">
                              <div class="avatar avatar-2xl me-3">
                                <img class="rounded-circle" src="/backend_Stock/assets/img/icons/weather-sm.jpg" alt="" />

                              </div>
                            </div>
                            <div class="notification-body">
                              <p class="mb-1">The forecast today shows a low of 20&#8451; in California. See today's weather.</p>
                              <span class="notification-time"><span class="me-2" role="img" aria-label="Emoji">üå§Ô∏è</span>1d</span>

                            </div>
                          </a>

                        </div>
                        <div class="list-group-item">
                          <a class="border-bottom-0 notification-unread  notification notification-flush" href="#!">
                            <div class="notification-avatar">
                              <div class="avatar avatar-xl me-3">
                                <img class="rounded-circle" src="/backend_Stock/assets/img/logos/oxford.png" alt="" />

                              </div>
                            </div>
                            <div class="notification-body">
                              <p class="mb-1"><strong>University of Oxford</strong> created an event : "Causal Inference Hilary 2019"</p>
                              <span class="notification-time"><span class="me-2" role="img" aria-label="Emoji">‚úåÔ∏è</span>1w</span>

                            </div>
                          </a>

                        </div>
                        <div class="list-group-item">
                          <a class="border-bottom-0 notification notification-flush" href="#!">
                            <div class="notification-avatar">
                              <div class="avatar avatar-xl me-3">
                                <img class="rounded-circle" src="/backend_Stock/assets/img/team/10.jpg" alt="" />

                              </div>
                            </div>
                            <div class="notification-body">
                              <p class="mb-1"><strong>James Cameron</strong> invited to join the group: United Nations International Children's Fund</p>
                              <span class="notification-time"><span class="me-2" role="img" aria-label="Emoji">üôã‚Äç</span>2d</span>

                            </div>
                          </a>

                        </div>
                      </div>
                    </div>
                    <div class="card-footer text-center border-top"><a class="card-link d-block" href="/backend_Stock/app/social/notifications.php">View all</a></div>
                  </div>
                </div>

              </li>
            
              <li class="nav-item dropdown"><a class="nav-link pe-0 ps-2" id="navbarDropdownUser" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <div class="avatar avatar-xl">
                    <img class="rounded-circle" id="userAvatarImg" src="/backend_Stock/assets/img/team/3-thumb.png" alt="User Avatar" />

                  </div>
                </a>
                <div class="dropdown-menu dropdown-caret dropdown-caret dropdown-menu-end py-0" aria-labelledby="navbarDropdownUser">
                  <div class="bg-white dark__bg-1000 rounded-2 py-2">
                    <div class="dropdown-item fw-bold d-flex align-items-center justify-content-between px-3 py-2">
                      <div>
                        <div class="fw-bold" id="userNameDisplay">User</div>
                        <div class="small text-500" id="userRoleDisplay">Role</div>
                      </div>
                      <span class="badge rounded-pill" id="userRoleBadge" style="background-color: #28a745;">Admin</span>
                    </div>

                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="setting.php">Settings</a>
                    <button class="dropdown-item" id="nav-logout" style="border: none; background: none; cursor: pointer; text-align: left; width: 100%;">Logout</button>
                  </div>
                </div>
              </li>
            </ul>
          </nav>
          <script>
              (function(){
              const apiBase = 'https://backend-gestion-de-stock.onrender.com';

              function getToken(){
                return localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt') || localStorage.getItem('accessToken') || localStorage.getItem('userToken') || null;
              }

              function authHeaders(){
                const token = getToken();
                return token ? { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' } : {};
              }

              // Decode JWT payload (no validation) to read role/id/nom
              function decodeJwt(token){
                try{
                  const payload = token.split('.')[1];
                  const decoded = atob(payload.replace(/-/g,'+').replace(/_/g,'/'));
                  return JSON.parse(decodeURIComponent(escape(decoded)));
                }catch(e){
                  console.warn('[topbar] decodeJwt error:', e);
                  return null;
                }
              }

              function displayUserInfo(user){
                console.log('[topbar] displayUserInfo called with user:', user);
                
                // Display name and role
                const nameEl = document.getElementById('userNameDisplay');
                if(nameEl) {
                  nameEl.textContent = ((user.prenom || '') + ' ' + (user.nom || '')).trim() || 'User';
                  console.log('[topbar] Name set to:', nameEl.textContent);
                }

                const roleEl = document.getElementById('userRoleDisplay');
                if(roleEl) {
                  roleEl.textContent = user.role || 'User';
                  console.log('[topbar] Role set to:', roleEl.textContent);
                }

                // Display role badge with color based on role
                const badgeEl = document.getElementById('userRoleBadge');
                if(badgeEl){
                  badgeEl.textContent = (user.role || 'User').charAt(0).toUpperCase() + (user.role || 'User').slice(1);
                  // Set badge color based on role
                  const role = (user.role || '').toLowerCase();
                  if(role === 'admin') badgeEl.style.backgroundColor = '#28a745'; // green
                  else if(role === 'superviseur') badgeEl.style.backgroundColor = '#007bff'; // blue
                  else if(role === 'vendeur') badgeEl.style.backgroundColor = '#ffc107'; // yellow
                  else badgeEl.style.backgroundColor = '#6c757d'; // gray
                  console.log('[topbar] Badge role set to:', badgeEl.textContent, 'color:', badgeEl.style.backgroundColor);
                }

                // Display user photo if available
                const imgEl = document.getElementById('userAvatarImg');
                if(imgEl) {
                  console.log('[topbar] Image element found, current src:', imgEl.src);
                  console.log('[topbar] user.photoUrl value:', user.photoUrl);
                  
                  if(user.photoUrl){
                    imgEl.src = user.photoUrl;
                    console.log('[topbar] Image src updated to:', imgEl.src);
                    
                    // Verify the image loaded
                    imgEl.onload = function(){
                      console.log('[topbar] Image loaded successfully from:', user.photoUrl);
                    };
                    imgEl.onerror = function(){
                      console.error('[topbar] Image failed to load from:', user.photoUrl);
                      imgEl.src = '/backend_Stock/assets/img/team/3-thumb.png';
                    };
                  } else {
                    console.warn('[topbar] No photoUrl available');
                  }
                } else {
                  console.warn('[topbar] Image element not found');
                }
              }

              // Fetch full user profile from API (same method as settings.js)
              async function fetchCurrentUserFromAPI(){
                const token = getToken();
                console.log('[topbar] fetchCurrentUserFromAPI - token exists:', !!token);
                
                if(!token){
                  console.warn('[topbar] No token found, using fallback');
                  loadUserInfoFromStorage();
                  return null;
                }

                // Decode token to get user ID
                const payload = decodeJwt(token);
                console.log('[topbar] Decoded token payload:', payload);
                
                const id = payload?.id || payload?._id || payload?.userId || payload?.sub;
                console.log('[topbar] Extracted user ID:', id);
                
                if(!id){
                  console.warn('[topbar] No user ID in token, using fallback');
                  loadUserInfoFromStorage();
                  return null;
                }

                try{
                  const url = apiBase + '/api/protected/profile/' + id;
                  console.log('[topbar] Fetching user profile from:', url);
                  
                  const res = await fetch(url, { 
                    method: 'GET',
                    headers: authHeaders()
                  });

                  console.log('[topbar] API response status:', res.status);

                  if(!res.ok){
                    console.warn('[topbar] API fetch failed (status ' + res.status + '), using fallback');
                    loadUserInfoFromStorage();
                    return null;
                  }

                  const user = await res.json();
                  console.log('[topbar] User profile fetched from API:', user);
                  console.log('[topbar] User photoUrl:', user.photoUrl);
                  
                  displayUserInfo(user);
                  return user;
                }catch(err){
                  console.error('[topbar] Error fetching user from API:', err);
                  console.warn('[topbar] Error details:', err.message);
                  loadUserInfoFromStorage();
                  return null;
                }
              }

              function loadUserInfoFromStorage(){
                const nom = localStorage.getItem('nom') || localStorage.getItem('userNom') || 'User';
                const prenom = localStorage.getItem('prenom') || localStorage.getItem('userPrenom') || '';
                const role = localStorage.getItem('role') || localStorage.getItem('userRole') || 'Admin';
                const photoUrl = localStorage.getItem('photoUrl') || localStorage.getItem('userPhotoUrl') || null;

                console.log('[topbar] Loading user info from localStorage:');
                console.log('  nom:', nom);
                console.log('  prenom:', prenom);
                console.log('  role:', role);
                console.log('  photoUrl:', photoUrl);
                
                displayUserInfo({ nom, prenom, role, photoUrl });
              }

              function doLogout(e){
                if(e && e.preventDefault) e.preventDefault();
                if(e && e.stopPropagation) e.stopPropagation();
                console.log('[topbar] Starting logout process...');
                // Clear all user-related localStorage
                try{
                  localStorage.removeItem('token');
                  localStorage.removeItem('authToken');
                  localStorage.removeItem('jwt');
                  localStorage.removeItem('accessToken');
                  localStorage.removeItem('userToken');
                  localStorage.removeItem('id');
                  localStorage.removeItem('userId');
                  localStorage.removeItem('nom');
                  localStorage.removeItem('prenom');
                  localStorage.removeItem('role');
                  localStorage.removeItem('photoUrl');
                  localStorage.removeItem('userNom');
                  localStorage.removeItem('userPrenom');
                  localStorage.removeItem('userRole');
                  localStorage.removeItem('userPhotoUrl');
                  localStorage.removeItem('email');
                  localStorage.removeItem('businessId');
                  localStorage.removeItem('guichetId');
                  console.log('[topbar] localStorage cleared');
                }catch(err){
                  console.error('[topbar] Logout error:', err);
                }
                // redirect to login with robust fallback
                let loginUrl = '/backend_Stock/login.php';
                if(window.BASE_URL && window.BASE_URL.trim() && window.BASE_URL !== '/'){
                  loginUrl = window.BASE_URL + '/login.php';
                }
                console.log('[topbar] redirecting to:', loginUrl);
                setTimeout(() => { window.location.href = loginUrl; }, 100);
              }

              document.addEventListener('DOMContentLoaded', function(){
                // Load user info from API (with fallback to localStorage)
                fetchCurrentUserFromAPI();
                // Attach logout handler
                var btn = document.getElementById('nav-logout');
                if(btn) btn.addEventListener('click', doLogout);
              });
            })();
          </script>

